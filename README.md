University of Pennsylvania, ESE 5190: Intro to Embedded Systems, Lab 2A

Saurabh Sandeep Parulekar
   LinkedIn: https://www.linkedin.com/in/saurabh-parulekar/
Tested on: HP Pavillion Gaming Laptop, Windows 10 21H2

## Understanding the PIOASM generated file
The best way to explain any coding file is by the power given to us by all programming languages i.e comments, I have placed comments against functions/lines to explain their functionality. "ws2812.pio.h" file is generated by the pioasm which is included in the final C code("ws2812.c"), the ws2182_program_init() helps us configure the pio moduel from the C code
![one](https://github.com/saurabhparulekar24/LAB-2A-SAURABH-PARULEKAR-WORKED-WITH-AMOGH-GAJARE/blob/main/ws2812.c_1.png)
![two](https://github.com/saurabhparulekar24/LAB-2A-SAURABH-PARULEKAR-WORKED-WITH-AMOGH-GAJARE/blob/main/ws2812.pio.h_2.png)

## Understanding the ws2812.c file and its execution
The comments against each line/function explains what the line does, and on the far right we can follow the counter to see in what sequence the code runs, the up and down directions merely point where the next counter increment is. we have assumed that from the random pattern the code selects the random pattern.
![oneone](https://github.com/saurabhparulekar24/LAB-2A-SAURABH-PARULEKAR-WORKED-WITH-AMOGH-GAJARE/blob/main/ws2812_1.png)
![twotwo](https://github.com/saurabhparulekar24/LAB-2A-SAURABH-PARULEKAR-WORKED-WITH-AMOGH-GAJARE/blob/main/ws2812_2.png)
![threthre](https://github.com/saurabhparulekar24/LAB-2A-SAURABH-PARULEKAR-WORKED-WITH-AMOGH-GAJARE/blob/main/ws2812_3.png)
![fofo](https://github.com/saurabhparulekar24/LAB-2A-SAURABH-PARULEKAR-WORKED-WITH-AMOGH-GAJARE/blob/main/ws2812_4.png)


## Use of PIO module on RP2040

```
1) Why is bit-banging impractical on your laptop, despite it having a much faster processor than the RP2040?
   In today Pc although the processing power is much greater than RP2040, the layers of software and hardware between the processor and the outside world have also grown in number and size. Therefore it is difficult to obtain precise timing for hard real time applications. Incase of RP2040, it has a dedicated hardware called as the PIO, which runs separately, and hence it makes more sense to do bit-banging on this small microcontroller.

2) What are some cases where directly using the GPIO might be a better choice than using the PIO hardware?
   In cases where a precise timed signals are not required, such that sufficiently correct timing to an external hardware still makes it understand the signals. GPIO can be used for controlling things which need discrete signals and do not depend on hard and fast timing such as status Leds. It can be also used in a closed loop system such as PWM to motor Control.

3) How do you get data into a PIO state machine?
   To put data into the PIO state machine we need to put data into the FIFO_TXn register of that particular PIO state machine. We do this in the C file, we can directly push data by using the helper function “pio_sm_put_blocking()”. This function checks if the FIFO is full and waits to put data into it till it gets empty.

4) How do you get data out of a PIO state machine? 
   To get data out of the PIO state machine, we need to first write a pio code, in which when we execute a “out” statement, the data is written to the particular pin mentioned in that statement.

5) How do you program a PIO state machine?
   To program a PIO state machine we need to make a .pio file, using the assembly instructions given in the RP2040 datasheet we can program the precise pin behaviour we need. Once we program the behaviour we need add the configuration of the state machine in that same file(eg. Which state machine, which PIO etc). Then we need to edit the Cmake file and “ico_generate_pio_header()” to generate a .pio.h file which can be used in the C code to send data to the State machine.

6) In the example, which low-level C SDK function is directly responsible for telling the PIO to set the LED to a new color? How is this function accessed from the main “application” code?
   pio_sm_put_blocking(pio,sm,data) is a helper function which is directly responsible for telling the PIO to set LED to a new color. This function is accessed through the inline “put_pixel(data)” function.

7) What role does the pioasm “assembler” play in the example, and how does this interact with CMake?
   When we run the Pioasm, it will it will create some static variables describing the program, and a method ws2812_default_program_config which configures PIO state machine based on user parameters, and the directives in the actual PIO program. To invoke the pioasm we need to call “pico_generate_pio_header” which will create an “.h” header file, which is already included in out code.
```
## Spreadsheet of Initial PIO Register States

Drive link to the spreadsheet - https://docs.google.com/spreadsheets/d/1v-5flhdtm8m_76C8Aig0-hozPYN_lp9LQVL06rwW4Co/edit?usp=sharing (Sheet 1)

## Paper Modelling of the Code

![](https://github.com/amoghgajare/LAB2A-AMOGH-GAJARE-WORKED-WITH-SAURABH-PARULEKAR/blob/main/papermodel1.jpeg)
![](https://github.com/amoghgajare/LAB2A-AMOGH-GAJARE-WORKED-WITH-SAURABH-PARULEKAR/blob/main/papermodeltxcycle.jpeg)
![](https://github.com/amoghgajare/LAB2A-AMOGH-GAJARE-WORKED-WITH-SAURABH-PARULEKAR/blob/main/cycles.jpeg)

## Modeling in Excel
![](https://github.com/saurabhparulekar24/LAB-2A-SAURABH-PARULEKAR-WORKED-WITH-AMOGH-GAJARE/blob/main/Modeling_in_Excel.png)

## Packet Transmission Spreadsheet

Image link to Packet Transmission Timing Diagram - https://ibb.co/Zg1Fg4H (Please download the PNG file and Zoom to see the waveform)

We decided to do the initial part of the modeling on paper and then we moved on to excel, in both cases it proved difficult to model the long transmission and requires some other approach

What were some strengths/weaknesses of working with paper?
- Analysis of code can be done conveniently on paper. For example, Analysing the assembly code by labelling the instructions and determining the control flow was much easier on paper.

What were some strengths/weaknesses of working with spreadsheets?
- Working with registers becomes easier with the use of spreadsheets. but creating a timing diagram for a long transmission becomes very difficult

How might you approach this task using other tools available to you?
- We can use online timing diagram creators which are helpful but have an initial learning curves


